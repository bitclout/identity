<app-banner></app-banner>

<div
  *ngIf="!globalVars.callbackInvalid && !deleteKey"
  class="container home-container text-center"
>
  <div class="title-text">
    Grant signing access
    <span *ngIf="!globalVars.callback">to {{ globalVars.hostname }}</span>
  </div>
  <div
    class="fs-18px mb-20px"
    style="overflow: hidden; overflow-wrap: anywhere; word-break: break-all"
    *ngIf="publicKeyBase58Check"
  >
    <span class="fs-16px font-weight-normal">
      Public Key: {{ publicKeyBase58Check }}
    </span>
  </div>
  <div
    class="fs-18px mb-20px"
    style="overflow: hidden; overflow-wrap: anywhere; word-break: break-all"
    *ngIf="derivedPublicKeyBase58Check"
  >
    Derived Public Key:
    <span class="fs-16px font-weight-normal">{{
      derivedPublicKeyBase58Check
    }}</span>
  </div>
  <app-transaction-spending-limit
    [transactionSpendingLimitResponse]="transactionSpendingLimitResponse"
    *ngIf="transactionSpendingLimitResponse"
  ></app-transaction-spending-limit>

  <div *ngIf="!globalVars.callback">
    <div class="fs-18px mt-30px">
      <span class="fs-underline"
        ><b
          >You're about to grant {{ globalVars.hostname }} with signing
          access:</b
        ></span
      ><br />
      This means <b>{{ globalVars.hostname }}</b> will be able to make
      transactions on your behalf as if it knew your DeSo seed. This permission
      can be revoked anytime and it will automatically expire in about
      {{ expirationDays }} days.
    </div>
  </div>
  <div *ngIf="globalVars.callback">
    <div class="fs-18px mt-30px">
      <span class="fs-underline"
        ><b>You're about to grant signing access:</b></span
      ><br />
      This means the mobile application will be able to sign transactions on
      your behalf as if it knew your DeSo seed. This permission can be revoked
      anytime and it will automatically expire in about
      {{ expirationDays }} days. <br /><br />
      <span class="fs-underline"><b>DISCLAIMER:</b></span
      ><br />
      <b
        >This session is only for mobile applications. If you are not using a
        mobile application, you should exit this window.</b
      >
    </div>
  </div>
  <div class="d-flex flex-column" *ngIf="hasUsers">
    <ul class="list-group mt-7px mb-30px saved-seeds-list saved-seeds-scroll">
      <span class="saved-seeds-header d-flex align-items-center"
        ><span>Select an account</span></span
      >
      <li
        *ngFor="let item of orderUsers(allUsers | keyvalue)"
        class="list-group-item list-group-item-action cursor-pointer saved-seed"
        (click)="selectAccountAndDeriveKey(item.key)"
        [ngClass]="{ selectedKey: item.key === publicKeyBase58Check }"
      >
        <div class="w-100 d-flex justify-content-between">
          <div *ngIf="!item.value.username" class="text-left">
            <div class="my-1">
              <img
                class="avatar mr-15px"
                src="assets/placeholder-account-image.png"
              />
              {{ truncatePublicKey(item.key) }}
            </div>
          </div>
          <div *ngIf="item.value.username" class="d-flex align-items-center">
            <div class="avatar mr-15px" [appAvatar]="item.key"></div>
            <div class="">{{ item.value.username }}</div>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <div class="d-flex align-items-center flex-column">
    <button
      *ngIf="publicKeyBase58Check"
      type="button"
      class="button button-large button-primary mb-20px font-weight-bold"
      (click)="approveDerivedKey()"
    >
      Approve
    </button>
    <button
      class="button button-large button-primary mb-20px"
      (click)="launchGoogle()"
      *ngIf="!globalVars.hideGoogle"
    >
      <img
        src="assets/google_logo.svg"
        height="32px"
        width="32px"
        class="mr-10px"
      />
      <span class="font-weight-bold">Sign up / log in with Google</span>
    </button>
    <button
      class="button button-large button-secondary mb-20px"
      (click)="redirectSignUp()"
      queryParamsHandling="merge"
    >
      <span class="font-weight-normal">Sign up with DeSo seed</span>
    </button>
    <a class="link" (click)="redirectLoadSeed()" queryParamsHandling="merge"
      ><u>Log in with DeSo seed</u></a
    >
  </div>

  <div class="container home-container" *ngIf="deleteKey">
    <div>
      <div class="fs-18px mt-30px">
        <span class="fs-underline"
          ><b
            >You're about to revoke signing access for a Derived Public Key</b
          ></span
        ><br />
        This means <b>{{ derivedPublicKeyBase58Check }}</b> will no longer be
        able to make transactions on your behalf.
      </div>
    </div>
    <div class="pt-15px">
      <button
        *ngIf="publicKeyBase58Check"
        type="button"
        class="button button-large button-primary mb-20px"
        (click)="approveDerivedKey()"
      >
        Approve
      </button>
    </div>
  </div>
</div>
<div *ngIf="globalVars.callbackInvalid">
  <app-error-callback></app-error-callback>
</div>
